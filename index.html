<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Now</title>
    <link rel="stylesheet" href="src/styles.css">
</head>
<body>
    <div class="app">
        <header>
            <div class="badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M7 18h9a5 5 0 0 0 .6-9.97A6 6 0 0 0 6.1 10.3 4.5 4.5 0 0 0 7 18Z" fill="currentColor"/>
                </svg>
                Powered by Openâ€‘Meteo
            </div>
            <h1>Weather Now</h1>
            <p>Quick, beautiful current weather for any city.</p>
        </header>

        <main>
            <div class="search">
                <div class="field">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path d="m20 20-3.5-3.5" stroke="white" stroke-width="2" stroke-linecap="round"/>
                      <circle cx="11" cy="11" r="7" stroke="white" stroke-width="2"/>
                    </svg>
                    <input type="text" id="cityInput" placeholder="Search city e.g. London, Nairobi, Tokyo" />
                </div>
                <button id="searchButton">Search</button>
            </div>

            <div class="chips">
                <button class="chip" data-city="London">London</button>
                <button class="chip" data-city="Nairobi">Nairobi</button>
                <button class="chip" data-city="New York">New York</button>
                <button class="chip" data-city="Tokyo">Tokyo</button>
            </div>

            <div id="error" class="error" style="display: none;"></div>
            <div id="weatherCard" class="card" style="display: none;"></div>
        </main>

        <footer>
            <small>Data from Openâ€‘Meteo â€” no API key required.</small>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cityInput = document.getElementById('cityInput');
            const searchButton = document.getElementById('searchButton');
            const errorDiv = document.getElementById('error');
            const weatherCard = document.getElementById('weatherCard');

            async function fetchWeather(city) {
                try {
                    searchButton.disabled = true;
                    searchButton.textContent = 'Searching...';
                    errorDiv.style.display = 'none';
                    weatherCard.style.display = 'none';

                    // Geocoding
                    const geoRes = await fetch(
                        `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1`
                    );
                    const geo = await geoRes.json();
                    if (!geo.results || geo.results.length === 0) {
                        throw new Error('City not found');
                    }
                    const { latitude, longitude, name, country } = geo.results[0];

                    // Weather
                    const weatherRes = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`
                    );
                    const data = await weatherRes.json();
                    if (!data.current_weather) throw new Error('No weather data');

                    // Update UI
                    const code = data.current_weather.weathercode;
                    const icon = getWeatherIcon(code);
                    const desc = getWeatherDescription(code);
                    weatherCard.innerHTML = `
                        <div class="row">
                            <div class="iconWrap" aria-hidden="true">${icon}</div>
                            <div>
                                <h2 style="margin:0 0 6px">${name}, ${country}</h2>
                                <div class="big">${data.current_weather.temperature}Â°C</div>
                                <div class="meta">
                                   <div class="grid">
                                     <div><strong>Condition:</strong> ${desc}</div>
                                     <div><strong>Wind:</strong> ${data.current_weather.windspeed} km/h</div>
                                     <div><strong>Time:</strong> ${new Date(data.current_weather.time).toLocaleString()}</div>
                                     <div><strong>Direction:</strong> ${Math.round(data.current_weather.winddirection)}Â°</div>
                                   </div>
                                </div>
                            </div>
                        </div>
                    `;
                    weatherCard.style.display = 'block';
                } catch (err) {
                    errorDiv.textContent = err.message || 'Failed to fetch weather';
                    errorDiv.style.display = 'block';
                } finally {
                    searchButton.disabled = false;
                    searchButton.textContent = 'Search';
                }
            }

            function getWeatherDescription(code) {
                const descriptions = {
                    0: 'Clear sky',
                    1: 'Mainly clear',
                    2: 'Partly cloudy',
                    3: 'Overcast',
                    45: 'Fog',
                    48: 'Depositing rime fog',
                    51: 'Light drizzle',
                    61: 'Slight rain',
                    63: 'Moderate rain',
                    71: 'Slight snow',
                    80: 'Rain showers'
                };
                return descriptions[code] || `Code ${code}`;
            }

            function getWeatherIcon(code) {
                // Simple emoji-based icons for a clean, dependency-free UI
                if (code === 0) return 'â˜€ï¸';
                if (code === 1) return 'ðŸŒ¤ï¸';
                if (code === 2) return 'â›…';
                if (code === 3) return 'â˜ï¸';
                if (code === 45 || code === 48) return 'ðŸŒ«ï¸';
                if (code === 51) return 'ðŸŒ¦ï¸';
                if (code === 61 || code === 63 || code === 80) return 'ðŸŒ§ï¸';
                if (code === 71) return 'ðŸŒ¨ï¸';
                return 'ðŸŒ¡ï¸';
            }

            // Event listeners
            searchButton.addEventListener('click', () => {
                const city = cityInput.value.trim();
                if (city) fetchWeather(city);
            });

            cityInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    const city = cityInput.value.trim();
                    if (city) fetchWeather(city);
                }
            });

            document.querySelectorAll('.chip').forEach(btn => {
                btn.addEventListener('click', () => {
                    const city = btn.getAttribute('data-city');
                    cityInput.value = city;
                    fetchWeather(city);
                });
            });
        });
    </script>
</body>
</html>
